<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>kid_readout.measurement.basic &mdash; KID Readout  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="KID Readout  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">KID Readout  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for kid_readout.measurement.basic</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains basic measurement classes for data acquired with the roach.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">mlab</span>  <span class="c1"># TODO: replace with a scipy PSD estimator</span>

<span class="kn">from</span> <span class="nn">kid_readout.measurement</span> <span class="kn">import</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">kid_readout.analysis.resonator</span> <span class="kn">import</span> <span class="n">legacy_resonator</span>
<span class="kn">from</span> <span class="nn">kid_readout.analysis.timedomain.despike</span> <span class="kn">import</span> <span class="n">deglitch_window</span>
<span class="kn">from</span> <span class="nn">kid_readout.roach</span> <span class="kn">import</span> <span class="n">calculate</span>


<div class="viewcode-block" id="RoachStream"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.RoachStream">[docs]</a><span class="k">class</span> <span class="nc">RoachStream</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="p">,</span> <span class="n">tone_index</span><span class="p">,</span> <span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">s21_raw</span><span class="p">,</span>
                 <span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new RoachStream instance. The integer tone_index is the common index of tone_bin, tone_amplitude,</span>
<span class="sd">        and tone_phase for the single tone used to produce the time-ordered s21_raw data.</span>

<span class="sd">        :param tone_bin: an array of integers representing the frequencies of the tones played during the measurement.</span>
<span class="sd">        :param tone_amplitude: an array of floats representing the amplitudes of the tones played during the</span>
<span class="sd">          measurement.</span>
<span class="sd">        :param tone_phase: an array of floats representing the radian phases of the tones played during the measurement.</span>
<span class="sd">        :param tone_index: an int for which tone_bin[tone_index] corresponds to the frequency used to produce s21_raw.</span>
<span class="sd">        :param filterbank_bin: an int that is the filter bank bin in which the tone lies.</span>
<span class="sd">        :param epoch: float, unix timestamp of first sample of the time stream.</span>
<span class="sd">        :param s21_raw: an 1-D array of complex floats containing the data, demodulated or not.</span>
<span class="sd">        :param roach_state: a dict containing state information for the roach.</span>
<span class="sd">        :param state: a dict containing all non-roach state information.</span>
<span class="sd">        :param analyze: if True, call the analyze() method at the end of instantiation.</span>
<span class="sd">        :param description: a string describing this measurement.</span>
<span class="sd">        :return: a new RoachStream instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tone_bin</span> <span class="o">=</span> <span class="n">tone_bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tone_amplitude</span> <span class="o">=</span> <span class="n">tone_amplitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tone_phase</span> <span class="o">=</span> <span class="n">tone_phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tone_index</span> <span class="o">=</span> <span class="n">tone_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterbank_bin</span> <span class="o">=</span> <span class="n">filterbank_bin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">epoch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span> <span class="o">=</span> <span class="n">s21_raw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_demodulated</span> <span class="o">=</span> <span class="n">data_demodulated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">to_state_dict</span><span class="p">(</span><span class="n">roach_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_baseband_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean_error</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RoachStream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="RoachStream.analyze"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.RoachStream.analyze">[docs]</a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseband_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_sample_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw_mean_error</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sample_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">stream_sample_rate</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_index</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_MHz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">baseband_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseband_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_baseband_frequency</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">baseband_frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_index</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseband_frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">baseband_frequency_MHz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseband_frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stream_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">calculate</span><span class="o">.</span><span class="n">stream_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_raw_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_raw_mean_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean_error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean_error</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_mean_error</span>

<div class="viewcode-block" id="RoachStream.folded_shape"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.RoachStream.folded_shape">[docs]</a>    <span class="k">def</span> <span class="nf">folded_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">period_samples</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">period_samples</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">period_samples</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">modulation_period_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period_samples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot fold unmodulated data or with period=0&quot;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="RoachStream.fold"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.RoachStream.fold">[docs]</a>    <span class="k">def</span> <span class="nf">fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">period_samples</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">reduce</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>
        <span class="n">reshaped</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folded_shape</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">period_samples</span><span class="o">=</span><span class="n">period_samples</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">reduce</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">reshaped</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">reshaped</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reshaped</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a StreamArray containing only the data corresponding to the times given in the slice. If no start (stop)</span>
<span class="sd">        time is given, the value is taken to be -inf (+inf). The returned StreamArray has the same state.</span>

<span class="sd">        The indexing follows the Python convention that the first value is inclusive and the second is exclusive:</span>
<span class="sd">        start &lt;= epoch &lt; stop</span>
<span class="sd">        Thus, the two slices stream_array[t0:t1] and stream_array[t1:t2] will contain all the data occurring at or after</span>
<span class="sd">        t0 and before t2, with no duplication. This means that</span>
<span class="sd">        stream_array[stream_array.epoch.min():stream_array.epoch.max()]</span>
<span class="sd">        will include all but the last sample.</span>

<span class="sd">        Passing a slice with a non-unity step size is not implemented and will raise a ValueError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Step size is not supported: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_time</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,),</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">stop_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_time</span><span class="p">,</span> <span class="p">(</span><span class="n">stop</span><span class="p">,),</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>  <span class="c1"># This index is not included</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">tone_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_amplitude</span><span class="p">,</span>
                                  <span class="n">tone_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_phase</span><span class="p">,</span> <span class="n">tone_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_index</span><span class="p">,</span>
                                  <span class="n">filterbank_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_time</span><span class="p">[</span><span class="n">start_index</span><span class="p">],</span>
                                  <span class="n">s21_raw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">start_index</span><span class="p">:</span><span class="n">stop_index</span><span class="p">],</span>
                                  <span class="n">data_demodulated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span>
                                  <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid slice: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>


<div class="viewcode-block" id="SingleStream"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleStream">[docs]</a><span class="k">class</span> <span class="nc">SingleStream</span><span class="p">(</span><span class="n">RoachStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains time-ordered data from a single channel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;tone_amplitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;tone_phase&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;s21_raw&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;sample_time&#39;</span><span class="p">,)}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="p">,</span> <span class="n">tone_index</span><span class="p">,</span> <span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">s21_raw</span><span class="p">,</span>
                 <span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new SingleStream instance. The integer tone_index is the common index of tone_bin, tone_amplitude,</span>
<span class="sd">        and tone_phase for the single tone used to produce the time-ordered s21_raw data.</span>

<span class="sd">        :param tone_bin: an array of integers representing the frequencies of the tones played during the measurement.</span>
<span class="sd">        :param tone_amplitude: an array of floats representing the amplitudes of the tones played during the</span>
<span class="sd">          measurement.</span>
<span class="sd">        :param tone_phase: an array of floats representing the radian phases of the tones played during the measurement.</span>
<span class="sd">        :param tone_index: an int for which tone_bin[tone_index] corresponds to the frequency used to produce s21_raw.</span>
<span class="sd">        :param filterbank_bin: an int that is the filter bank bin in which the tone lies.</span>
<span class="sd">        :param epoch: a float that is the unix timestamp of first sample of the time stream.</span>
<span class="sd">        :param s21_raw: an 1-D array of complex floats containing the data, demodulated or not.</span>
<span class="sd">        :param data_demodulated: True if the s21_raw data are demodulated.</span>
<span class="sd">        :param roach_state: a dict containing state information for the roach.</span>
<span class="sd">        :param state: a dict containing all non-roach state information.</span>
<span class="sd">        :param analyze: if True, call the analyze() method at the end of instantiation.</span>
<span class="sd">        :param description: a string describing this measurement.</span>
<span class="sd">        :return: a new SingleStream instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleStream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">tone_bin</span><span class="o">=</span><span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="o">=</span><span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="o">=</span><span class="n">tone_phase</span><span class="p">,</span>
                                           <span class="n">tone_index</span><span class="o">=</span><span class="n">tone_index</span><span class="p">,</span> <span class="n">filterbank_bin</span><span class="o">=</span><span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
                                           <span class="n">s21_raw</span><span class="o">=</span><span class="n">s21_raw</span><span class="p">,</span> <span class="n">data_demodulated</span><span class="o">=</span><span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="o">=</span><span class="n">roach_state</span><span class="p">,</span>
                                           <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw_mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_point_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_raw_mean_error</span></div>


<div class="viewcode-block" id="StreamArray"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.StreamArray">[docs]</a><span class="k">class</span> <span class="nc">StreamArray</span><span class="p">(</span><span class="n">RoachStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents simultaneously-sampled data from multiple channels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;tone_amplitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;tone_phase&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_bin&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;tone_index&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_index&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;filterbank_bin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_index&#39;</span><span class="p">,),</span>
                  <span class="s1">&#39;s21_raw&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;tone_index&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_time&#39;</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="p">,</span> <span class="n">tone_index</span><span class="p">,</span> <span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">s21_raw</span><span class="p">,</span>
                 <span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new StreamArray instance. The integer array tone_index contains the indices of tone_bin,</span>
<span class="sd">        tone_amplitude, and tone_phase for the tones demodulated to produce the time-ordered s21_raw data.</span>

<span class="sd">        The tone_bin, tone_amplitude, tone_phase, tone_index, and filterbank_bin arrays are 1-D, while s21_raw is</span>
<span class="sd">        2-D with</span>
<span class="sd">        s21_raw.shape == (tone_index.size, sample_time.size)</span>

<span class="sd">        :param tone_bin: an array of integers representing the frequencies of the tones played during the measurement.</span>
<span class="sd">        :param tone_amplitude: an array of floats representing the amplitudes of the tones played during the</span>
<span class="sd">          measurement.</span>
<span class="sd">        :param tone_phase: an array of floats representing the radian phases of the tones played during the measurement.</span>
<span class="sd">        :param tone_index: an int array for which tone_bin[tone_index] gives the integer frequencies of the tones read</span>
<span class="sd">          out in this measurement.</span>
<span class="sd">        :param filterbank_bin: an int array of filter bank bins in which the read out tones lie.</span>
<span class="sd">        :param epoch: a float that is the unix timestamp of first sample of the time stream.</span>
<span class="sd">        :param s21_raw: a 2-D array of complex floats containing the data, demodulated or not.</span>
<span class="sd">        :param data_demodulated: True if the s21_raw data are demodulated.</span>
<span class="sd">        :param roach_state: a dict containing state information for the roach.</span>
<span class="sd">        :param state: a dict containing all non-roach state information.</span>
<span class="sd">        :param analyze: if True, call the analyze() method at the end of instantiation.</span>
<span class="sd">        :param description: a string describing this measurement.</span>
<span class="sd">        :return: a new StreamArray instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">StreamArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">tone_bin</span><span class="o">=</span><span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="o">=</span><span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="o">=</span><span class="n">tone_phase</span><span class="p">,</span>
                                          <span class="n">tone_index</span><span class="o">=</span><span class="n">tone_index</span><span class="p">,</span> <span class="n">filterbank_bin</span><span class="o">=</span><span class="n">filterbank_bin</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
                                          <span class="n">s21_raw</span><span class="o">=</span><span class="n">s21_raw</span><span class="p">,</span> <span class="n">data_demodulated</span><span class="o">=</span><span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="o">=</span><span class="n">roach_state</span><span class="p">,</span>
                                          <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="StreamArray.stream"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.StreamArray.stream">[docs]</a>    <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tone_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a SingleStream object containing the data at the frequency corresponding to the given integer tone_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tone_index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SingleStream</span><span class="p">(</span><span class="n">tone_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">,</span> <span class="n">tone_amplitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_amplitude</span><span class="p">,</span> <span class="n">tone_phase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_phase</span><span class="p">,</span>
                                <span class="n">tone_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tone_index</span><span class="p">[</span><span class="n">tone_index</span><span class="p">],</span> <span class="n">filterbank_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filterbank_bin</span><span class="p">[</span><span class="n">tone_index</span><span class="p">],</span>
                                <span class="n">epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">s21_raw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s21_raw</span><span class="p">[</span><span class="n">tone_index</span><span class="p">,</span> <span class="p">:],</span>
                                <span class="n">data_demodulated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_demodulated</span><span class="p">,</span> <span class="n">roach_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid tone index: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tone_index</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="SingleSweep"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleSweep">[docs]</a><span class="k">class</span> <span class="nc">SingleSweep</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents a group of streams with different frequencies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a SingleSweep object. The streams are not sorted internally.</span>

<span class="sd">        :param streams: a MeasurementList of Streams.</span>
<span class="sd">        :param state: a dictionary containing state information.</span>
<span class="sd">        :param analyze:</span>
<span class="sd">        :param description: a string description of this measurement.</span>
<span class="sd">        :return: a new SingleSweep object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span> <span class="o">=</span> <span class="n">streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points_error</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleSweep</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">frequency</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">s21_point</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_points_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points_error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">s21_point_error</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_points_error</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_bin_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                             <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_amplitude_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_amplitude</span><span class="p">[</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                                   <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_phase_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_phase</span><span class="p">[</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                              <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filterbank_bin_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">filterbank_bin</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_raw_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">stream</span><span class="o">.</span><span class="n">s21_raw</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">calculate</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span>
                                                                  <span class="n">stream</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="n">stream</span><span class="o">.</span><span class="n">tone_index</span><span class="p">])</span>
                                              <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_MHz_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_stack</span></div>


<div class="viewcode-block" id="SingleResonatorSweep"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleResonatorSweep">[docs]</a><span class="k">class</span> <span class="nc">SingleResonatorSweep</span><span class="p">(</span><span class="n">SingleSweep</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resonator</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized_error</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleResonatorSweep</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">streams</span><span class="o">=</span><span class="n">streams</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="SingleResonatorSweep.analyze"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleResonatorSweep.analyze">[docs]</a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonator</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_s21_normalized</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized</span>

    <span class="k">def</span> <span class="nf">_set_s21_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s21</span><span class="p">)</span>
                                         <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">s21</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_points</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_normalized_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized_error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_s21_normalized_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized_error</span>

    <span class="k">def</span> <span class="nf">_set_s21_normalized_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_normalized_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s21_error</span><span class="p">)</span>
                                               <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">s21_error</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_points_error</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">resonator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resonator</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_resonator</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resonator</span>

<div class="viewcode-block" id="SingleResonatorSweep.fit_resonator"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleResonatorSweep.fit_resonator">[docs]</a>    <span class="k">def</span> <span class="nf">fit_resonator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay_estimate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nonlinear_a_threshold</span><span class="o">=</span><span class="mf">0.08</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resonator</span> <span class="o">=</span> <span class="n">legacy_resonator</span><span class="o">.</span><span class="n">fit_best_resonator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21_points</span><span class="p">,</span>
                                                           <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s21_points_error</span><span class="p">,</span>
                                                       <span class="n">delay_estimate</span><span class="o">=</span><span class="n">delay_estimate</span><span class="p">,</span> <span class="n">min_a</span><span class="o">=</span><span class="n">nonlinear_a_threshold</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SweepArray"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepArray">[docs]</a><span class="k">class</span> <span class="nc">SweepArray</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains a list of stream arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_arrays</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span> <span class="o">=</span> <span class="n">stream_arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SweepArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="SweepArray.sweep"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepArray.sweep">[docs]</a>    <span class="k">def</span> <span class="nf">sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SingleSweep</span><span class="p">(</span><span class="n">streams</span><span class="o">=</span><span class="n">core</span><span class="o">.</span><span class="n">MeasurementList</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">),</span>
                               <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid index: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="n">sa</span><span class="o">.</span><span class="n">tone_index</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Channel numbers differ between stream arrays.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tone_index</span><span class="o">.</span><span class="n">size</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_bin_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                                   <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_bin_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_amplitude_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_amplitude</span><span class="p">[</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                                         <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_amplitude_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tone_phase_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_phase</span><span class="p">[</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_index</span><span class="p">]</span>
                                                     <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tone_phase_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filterbank_bin_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">stream_array</span><span class="o">.</span><span class="n">filterbank_bin</span>
                                                         <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterbank_bin_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s21_raw_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">stream_array</span><span class="o">.</span><span class="n">s21_raw</span> <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s21_raw_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">calculate</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="n">stream_array</span><span class="o">.</span><span class="n">roach_state</span><span class="p">,</span>
                                                                        <span class="n">stream_array</span><span class="o">.</span><span class="n">tone_bin</span><span class="p">[</span><span class="n">stream_array</span><span class="o">.</span><span class="n">tone_index</span><span class="p">])</span>
                                                    <span class="k">for</span> <span class="n">stream_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequency_stack</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frequency_MHz_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_stack</span></div>


<div class="viewcode-block" id="ResonatorSweepArray"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.ResonatorSweepArray">[docs]</a><span class="k">class</span> <span class="nc">ResonatorSweepArray</span><span class="p">(</span><span class="n">SweepArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents a set of groups of streams.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_arrays</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ResonatorSweepArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">stream_arrays</span><span class="o">=</span><span class="n">stream_arrays</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span>
                                                  <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="ResonatorSweepArray.sweep"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.ResonatorSweepArray.sweep">[docs]</a>    <span class="k">def</span> <span class="nf">sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SingleResonatorSweep</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">MeasurementList</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_arrays</span><span class="p">),</span>
                                        <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid index: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="SingleSweepStream"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleSweepStream">[docs]</a><span class="k">class</span> <span class="nc">SingleSweepStream</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span> <span class="o">=</span> <span class="n">sweep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">fold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folded_shape</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">folded_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized_deglitched</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_qq</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_xx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleSweepStream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="SingleSweepStream.analyze"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleSweepStream.analyze">[docs]</a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_stream_s21_normalized_deglitched</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_q_and_x</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_S_qq_and_S_xx</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stream_s21_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">s21_raw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stream_s21_normalized_deglitched</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized_deglitched</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_stream_s21_normalized_deglitched</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized_deglitched</span>

    <span class="k">def</span> <span class="nf">_set_stream_s21_normalized_deglitched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_in_seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">deglitch_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">window</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">window_in_seconds</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">stream_sample_rate</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_s21_normalized_deglitched</span> <span class="o">=</span> <span class="n">deglitch_window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_s21_normalized</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span>
                                                                 <span class="n">thresh</span><span class="o">=</span><span class="n">deglitch_threshold</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the inverse internal quality factor q = 1 / Q_i calculated by inverting the resonator model.</span>
<span class="sd">        :return: an array of q values from self.stream corresponding to self.stream.epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_q_and_x</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return half the inverse internal quality factor y = q / 2 calculated by inverting the resonator model. The</span>
<span class="sd">        purpose of this is that S_yy = S_xx when amplifier-noise dominated.</span>
<span class="sd">        :return: an array of y values from self.stream corresponding to self.stream.epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the fractional frequency shift x = f / f_r - 1 calculated by inverting the resonator model.</span>
<span class="sd">        :return: an array of x values from self.stream corresponding to self.stream.epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_q_and_x</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>

    <span class="k">def</span> <span class="nf">_set_q_and_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deglitch</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">deglitch</span><span class="p">:</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_s21_normalized_deglitched</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_s21_normalized</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">Q_e</span>  <span class="c1"># c is the inverse of the complex couping quality factor.</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s21</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">real</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># This factor of two means S_xx = S_qq / 4 when amplifier noise dominated.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">S_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the frequencies used in calculating the single-sided spectral densities.</span>
<span class="sd">        :return: an array of frequencies ranging from 0 through the Nyquist frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_S_qq_and_S_xx</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_frequency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">S_qq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The single-sided spectral density of q(t), S_qq(f), where f is self.S_frequency.</span>
<span class="sd">        :return: an array of complex values representing the spectral density of q(t)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_qq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_S_qq_and_S_xx</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_qq</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">S_yy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The single-sided spectral density of y(t), S_yy(f), where f is self.S_frequency.</span>
<span class="sd">        :return: an array of complex values representing the spectral density of y(t)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_qq</span> <span class="o">/</span> <span class="mi">4</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">S_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The single-sided spectral density of x(t), S_xx(f), where f is self.S_frequency.</span>
<span class="sd">        :return: an array of complex values representing the spectral density of x(t)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_xx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_S_qq_and_S_xx</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_S_xx</span>

    <span class="c1"># TODO: calculate errors in PSDs</span>
    <span class="k">def</span> <span class="nf">_set_S_qq_and_S_xx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NFFT</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">window_none</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Use the same length calculation as SweepNoiseMeasurement</span>
        <span class="k">if</span> <span class="n">NFFT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">NFFT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">s21_raw</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">S_qq</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">stream_sample_rate</span><span class="p">,</span> <span class="n">NFFT</span><span class="o">=</span><span class="n">NFFT</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">S_xx</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">stream_sample_rate</span><span class="p">,</span> <span class="n">NFFT</span><span class="o">=</span><span class="n">NFFT</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_frequency</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_qq</span> <span class="o">=</span> <span class="n">S_qq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S_xx</span> <span class="o">=</span> <span class="n">S_xx</span>

<div class="viewcode-block" id="SingleSweepStream.to_dataframe"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleSweepStream.to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">thermometer</span><span class="p">,</span> <span class="n">temperature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thermometer</span><span class="p">)]</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># TODO: need to flatten sub-dicts, if any.</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">roach_state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;roach_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;resonator_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;resonator_{}_error&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;resonator_redchi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">resonator</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">redchi</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_origin</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataframe</span></div></div>


<div class="viewcode-block" id="SweepStreamArray"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamArray">[docs]</a><span class="k">class</span> <span class="nc">SweepStreamArray</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep_array</span><span class="p">,</span> <span class="n">stream_array</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sweep_array</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">!=</span> <span class="n">stream_array</span><span class="o">.</span><span class="n">tone_index</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">MeasurementError</span><span class="p">(</span><span class="s2">&quot;The number of SweepArray channels does not match the StreamArray number.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_array</span> <span class="o">=</span> <span class="n">sweep_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_array</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_array</span> <span class="o">=</span> <span class="n">stream_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_array</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SweepStreamArray</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

<div class="viewcode-block" id="SweepStreamArray.analyze"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamArray.analyze">[docs]</a>    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_array</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_array</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_array</span><span class="o">.</span><span class="n">num_channels</span>

<div class="viewcode-block" id="SweepStreamArray.sweep_stream"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamArray.sweep_stream">[docs]</a>    <span class="k">def</span> <span class="nf">sweep_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a SweepStream object containing the data at the frequency corresponding to the given integer index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">SingleSweepStream</span><span class="p">(</span><span class="n">sweep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_array</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">stream</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_array</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                                     <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid index: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span></div>

<div class="viewcode-block" id="SweepStreamArray.to_dataframe"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamArray.to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dataframes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span><span class="p">):</span>
            <span class="n">dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_stream</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SweepStreamList"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamList">[docs]</a><span class="k">class</span> <span class="nc">SweepStreamList</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep</span><span class="p">,</span> <span class="n">stream_list</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SweepStreamList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span> <span class="o">=</span> <span class="n">sweep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="n">stream_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="SweepStreamList.single_sweep_stream_list"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SweepStreamList.single_sweep_stream_list">[docs]</a>    <span class="k">def</span> <span class="nf">single_sweep_stream_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SingleSweepStreamList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                                     <span class="n">core</span><span class="o">.</span><span class="n">MeasurementList</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">sa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="p">),</span>
                                     <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="SingleSweepStreamList"><a class="viewcode-back" href="../../../kid_readout.measurement.html#kid_readout.measurement.basic.SingleSweepStreamList">[docs]</a><span class="k">class</span> <span class="nc">SingleSweepStreamList</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Measurement</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_sweep</span><span class="p">,</span> <span class="n">stream_list</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">analyze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SingleSweepStreamList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">analyze</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span> <span class="o">=</span> <span class="n">single_sweep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span> <span class="o">=</span> <span class="n">stream_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_list</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">KID Readout  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>kid_readout.analysis.dataframe &mdash; KID Readout  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="KID Readout  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">KID Readout  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for kid_readout.analysis.dataframe</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is for functions that operate on DataFrames.</span>

<span class="sd">Only the functions that use groupby should return the DataFrame.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">lmfit</span>
<span class="kn">from</span> <span class="nn">kid_readout.analysis.resonator.khalil</span> <span class="kn">import</span> <span class="n">qi_error</span>
<span class="kn">from</span> <span class="nn">kid_readout.analysis</span> <span class="kn">import</span> <span class="n">archive</span>


<div class="viewcode-block" id="analyze"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.analyze">[docs]</a><span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">channel_to_location</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maximum_fractional_f_r_error</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">maximum_iQi_error</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="c1"># TODO: the next three function calls should be deprecated when the underlying code is updated</span>
    <span class="n">rename_f</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">add_Q_i_err</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">add_channel</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">channel_to_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">add_location</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">channel_to_location</span><span class="p">)</span>
    <span class="n">add_resonator_fit_good</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">maximum_fractional_f_r_error</span><span class="p">,</span> <span class="n">maximum_iQi_error</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="n">add_noise_fits</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="analyze_mmw_source_data"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.analyze_mmw_source_data">[docs]</a><span class="k">def</span> <span class="nf">analyze_mmw_source_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">zbd_fraction</span><span class="p">,</span> <span class="n">optical_frequency</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">linearize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="c1"># TODO: this is a hack that should be deprecated when the voltages in other code are updated</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;zbd_voltage&#39;</span><span class="p">:</span> <span class="s1">&#39;lockin_rms_voltage&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">add_zbd_voltage</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">linearize</span><span class="p">)</span>
    <span class="n">add_zbd_power</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">optical_frequency</span><span class="p">)</span>
    <span class="n">add_source_power</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">zbd_fraction</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">archive</span><span class="o">.</span><span class="n">add_total_mmw_attenuator_turns</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="rename_f"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.rename_f">[docs]</a><span class="k">def</span> <span class="nf">rename_f</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;f_0&#39;</span><span class="p">:</span> <span class="s1">&#39;f_r&#39;</span><span class="p">,</span> <span class="s1">&#39;f_0_err&#39;</span><span class="p">:</span> <span class="s1">&#39;f_r_err&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>


<span class="c1"># TODO: this should be deprecated when the error on Q_i or Q_i**-1 is computed upstream.</span>
<div class="viewcode-block" id="add_Q_i_err"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_Q_i_err">[docs]</a><span class="k">def</span> <span class="nf">add_Q_i_err</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Q_i_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">qi_error</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Q_err</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Q_e_real</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Q_e_real_err</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Q_e_imag</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">Q_e_imag_err</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span></div>


<span class="c1"># This should work except in pathological cases; groupby sorts by key automatically.</span>
<div class="viewcode-block" id="add_channel"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_channel">[docs]</a><span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">resonator_index_to_channel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">f_r</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;resonator_index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resonator_index_to_channel</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">resonator_index</span><span class="p">)]</span></div>


<div class="viewcode-block" id="add_location"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_location">[docs]</a><span class="k">def</span> <span class="nf">add_location</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">channel_to_location</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">channel_to_location</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">channel</span><span class="p">)]</span></div>


<div class="viewcode-block" id="add_zbd_voltage"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_zbd_voltage">[docs]</a><span class="k">def</span> <span class="nf">add_zbd_voltage</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">linearize</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The modulated square wave has minimum 0 and maximum V_z, equivalent to an offset square wave with peak V_z / 2.</span>
<span class="sd">    The lock-in measures the Fourier component at the reference frequency and reports RMS voltage, so in this case it</span>
<span class="sd">    will report</span>
<span class="sd">    V_l = (V_z / 2) (4 / \pi) 2^{-1/2} = (2^{1/2} / \pi) V_z.</span>
<span class="sd">    The peak ZBD voltage is thus</span>
<span class="sd">    V_z = 2^{-1/2} \pi V_l</span>

<span class="sd">    :param df: The dataframe.</span>
<span class="sd">    :param linearize: If True, the measured ZBD voltage is corrected based on the measured linearity.</span>
<span class="sd">    :return: None; the dataframe is modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">measured_zbd_voltage</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">lockin_rms_voltage</span>
    <span class="k">if</span> <span class="n">linearize</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">equipment.vdi.zbd</span> <span class="kn">import</span> <span class="n">ZBD</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;zbd_voltage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measured_zbd_voltage</span> <span class="o">/</span> <span class="n">ZBD</span><span class="p">()</span><span class="o">.</span><span class="n">linearity</span><span class="p">(</span><span class="n">measured_zbd_voltage</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;zbd_voltage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measured_zbd_voltage</span></div>


<div class="viewcode-block" id="add_zbd_power"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_zbd_power">[docs]</a><span class="k">def</span> <span class="nf">add_zbd_power</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">optical_frequency</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param df: The dataframe.</span>
<span class="sd">    :param optical_frequency: The frequency in hertz detected by the ZBD; the default responsivity is close to the</span>
<span class="sd">    measured 150 GHz responsivity, and was previously used in most code.</span>
<span class="sd">    :return: None; the dataframe is modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">optical_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">zbd_volts_per_watt</span> <span class="o">=</span> <span class="mi">2200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">equipment.vdi.zbd</span> <span class="kn">import</span> <span class="n">ZBD</span>
        <span class="n">zbd_volts_per_watt</span> <span class="o">=</span> <span class="n">ZBD</span><span class="p">()</span><span class="o">.</span><span class="n">responsivity</span><span class="p">(</span><span class="n">optical_frequency</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;zbd_power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;zbd_voltage&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">zbd_volts_per_watt</span></div>


<div class="viewcode-block" id="add_source_power"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_source_power">[docs]</a><span class="k">def</span> <span class="nf">add_source_power</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">zbd_fraction</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;source_power&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">zbd_power</span> <span class="o">/</span> <span class="n">zbd_fraction</span></div>


<div class="viewcode-block" id="add_resonator_fit_good"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_resonator_fit_good">[docs]</a><span class="k">def</span> <span class="nf">add_resonator_fit_good</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">maximum_fractional_f_r_error</span><span class="p">,</span> <span class="n">maximum_iQi_error</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;resonator_fit_good&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">f_r_err</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">f_r</span> <span class="o">&lt;</span> <span class="n">maximum_fractional_f_r_error</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Q_i_err</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">Q_i</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">maximum_iQi_error</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Q_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># This shouldn&#39;t be necessary, but it currently is.</span></div>

<div class="viewcode-block" id="add_temperature_groups"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_temperature_groups">[docs]</a><span class="k">def</span> <span class="nf">add_temperature_groups</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">temperature_deviation_K</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">,</span><span class="n">temperature_field</span><span class="o">=</span><span class="s1">&#39;sweep_primary_package_temperature&#39;</span><span class="p">,</span>
                           <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">current_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">temperature_field</span><span class="p">]</span>
    <span class="n">group_field</span> <span class="o">=</span> <span class="n">temperature_field</span><span class="o">+</span><span class="s1">&#39;_group&#39;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">group_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">current_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">temperature_field</span><span class="p">]</span> <span class="o">-</span> <span class="n">level</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">temperature_deviation_K</span>
        <span class="n">level_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">temperature_field</span><span class="p">][</span><span class="n">new_mask</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">level_mean</span><span class="o">/</span><span class="n">temperature_deviation_K</span><span class="p">)</span><span class="o">*</span><span class="n">temperature_deviation_K</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;found level&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="s2">&quot;matching&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">new_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span> <span class="s2">&quot;data points. Mean of this set:&quot;</span><span class="p">,</span><span class="n">level_mean</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_mask</span><span class="p">,</span><span class="n">group_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">new_mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">|</span> <span class="n">new_mask</span>
        <span class="n">current_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">temperature_field</span><span class="p">][</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_data</span><span class="p">),</span><span class="s2">&quot;points remaining&quot;</span>
        <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">levels</span></div>

<span class="c1"># TODO: implement this in a separate module</span>
<div class="viewcode-block" id="fit_XI_temperature_response"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.fit_XI_temperature_response">[docs]</a><span class="k">def</span> <span class="nf">fit_XI_temperature_response</span><span class="p">():</span>
    <span class="k">pass</span></div>


<span class="c1"># TODO: move the response fitting functions to another module and rename them.</span>
<div class="viewcode-block" id="n_qp_over_n_star"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.n_qp_over_n_star">[docs]</a><span class="k">def</span> <span class="nf">n_qp_over_n_star</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="n">P_0</span><span class="p">)</span> <span class="o">/</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="X"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.X">[docs]</a><span class="k">def</span> <span class="nf">X</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">X_0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">X_0</span> <span class="o">*</span> <span class="n">n_qp_over_n_star</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">)</span></div>


<div class="viewcode-block" id="X_model"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.X_model">[docs]</a><span class="k">def</span> <span class="nf">X_model</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;X_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="dX_dP"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.dX_dP">[docs]</a><span class="k">def</span> <span class="nf">dX_dP</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">X_0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">X_0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="n">P_0</span><span class="p">)</span> <span class="o">/</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="X_inverse"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.X_inverse">[docs]</a><span class="k">def</span> <span class="nf">X_inverse</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">X_0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">P_star</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">X</span> <span class="o">/</span> <span class="n">X_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P_0</span></div>


<div class="viewcode-block" id="X_residual"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.X_residual">[docs]</a><span class="k">def</span> <span class="nf">X_residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">X_errors</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X_data</span> <span class="o">-</span> <span class="n">X_model</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">))</span> <span class="o">/</span> <span class="n">X_errors</span></div>


<div class="viewcode-block" id="I"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.I">[docs]</a><span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">I_0</span><span class="p">,</span> <span class="n">I_C</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I_0</span> <span class="o">*</span> <span class="n">n_qp_over_n_star</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">+</span> <span class="n">I_C</span></div>


<div class="viewcode-block" id="I_model"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.I_model">[docs]</a><span class="k">def</span> <span class="nf">I_model</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;I_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;I_C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="dI_dP"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.dI_dP">[docs]</a><span class="k">def</span> <span class="nf">dI_dP</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">I_0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I_0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="n">P_0</span><span class="p">)</span> <span class="o">/</span> <span class="n">P_star</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="I_inverse"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.I_inverse">[docs]</a><span class="k">def</span> <span class="nf">I_inverse</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">I_0</span><span class="p">,</span> <span class="n">I_C</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">P_star</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">I_C</span><span class="p">)</span> <span class="o">/</span> <span class="n">I_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">P_0</span></div>


<div class="viewcode-block" id="I_residual"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.I_residual">[docs]</a><span class="k">def</span> <span class="nf">I_residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">I_errors</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">I_data</span> <span class="o">-</span> <span class="n">I_model</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">))</span> <span class="o">/</span> <span class="n">I_errors</span></div>


<div class="viewcode-block" id="residual"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.residual">[docs]</a><span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">X_errors</span><span class="p">,</span> <span class="n">I_errors</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">X_residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">X_errors</span><span class="p">),</span>
                           <span class="n">I_residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">I_errors</span><span class="p">)))</span></div>


<div class="viewcode-block" id="fit"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.fit">[docs]</a><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">X_errors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">I_errors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">X_errors</span><span class="p">,</span> <span class="n">I_errors</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># TODO: write a function that actually guesses</span>
<div class="viewcode-block" id="guess"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.guess">[docs]</a><span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">I_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">parameters</span><span class="p">(</span><span class="mf">4e-8</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span></div>


<div class="viewcode-block" id="parameters"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.parameters">[docs]</a><span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="n">P_0</span><span class="p">,</span> <span class="n">P_star</span><span class="p">,</span> <span class="n">X_0</span><span class="p">,</span> <span class="n">I_0</span><span class="p">,</span> <span class="n">I_C</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;P_0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">P_0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;P_star&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">P_star</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;X_0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">X_0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;I_0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">I_0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;I_C&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">I_C</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span></div>


<div class="viewcode-block" id="add_response"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_response">[docs]</a><span class="k">def</span> <span class="nf">add_response</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">masker</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">masker</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">masker</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">f_r_max_row</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">f_r</span> <span class="o">==</span> <span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">f_r</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">f_r_max_row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># If no data is left after masking, return</span>
            <span class="n">f_r_max</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f_r_max_row</span><span class="o">.</span><span class="n">f_r</span><span class="p">)</span>
            <span class="n">f_r_max_err</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f_r_max_row</span><span class="o">.</span><span class="n">f_r_err</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_f_r_max&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_r_max</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_f_r_max_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_r_max_err</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_X&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">f_r_max</span> <span class="o">/</span> <span class="n">group</span><span class="o">.</span><span class="n">f_r</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_X_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">((</span><span class="n">f_r_max_err</span> <span class="o">/</span> <span class="n">f_r_max</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">f_r_err</span> <span class="o">/</span> <span class="n">group</span><span class="o">.</span><span class="n">f_r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_I&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">Q_i</span><span class="o">**-</span><span class="mi">1</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_I_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">Q_i</span><span class="o">**-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">group</span><span class="o">.</span><span class="n">Q_i_err</span>
        <span class="k">return</span> <span class="n">group</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;atten&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>


<span class="c1"># Remove bad data and power-off points before fitting.</span>
<div class="viewcode-block" id="add_fit_power_response"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_fit_power_response">[docs]</a><span class="k">def</span> <span class="nf">add_fit_power_response</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">masker</span><span class="o">=</span><span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)):</span>
    <span class="k">def</span> <span class="nf">fit_power_response</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">masker</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="n">power</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;{}_X&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)],</span> <span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;{}_I&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)],</span>
                         <span class="n">deepcopy</span><span class="p">(</span><span class="n">initial</span><span class="p">),</span>  <span class="c1"># This is crucial because minimize modifies the input Parameters.</span>
                         <span class="n">X_errors</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;{}_X_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)],</span> <span class="n">I_errors</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;{}_I_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fit_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span>
                <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fit_{}_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fit_redchi&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">redchi</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fit_dX_dP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dX_dP</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">power</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                              <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;X_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fit_dI_dP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dI_dP</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">power</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                              <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;P_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;I_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">group</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;atten&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_power_response</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="lagrange"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.lagrange">[docs]</a><span class="k">def</span> <span class="nf">lagrange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">([(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_data</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">k</span><span class="p">])</span></div>


<div class="viewcode-block" id="lagrange_interpolate"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.lagrange_interpolate">[docs]</a><span class="k">def</span> <span class="nf">lagrange_interpolate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">y_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_data</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span></div>


<div class="viewcode-block" id="dydx_2"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.dydx_2">[docs]</a><span class="k">def</span> <span class="nf">dydx_2</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return</span>
<span class="sd">    :param x0:</span>
<span class="sd">    :param x1:</span>
<span class="sd">    :param y0:</span>
<span class="sd">    :param y1:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span>
            <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span></div>


<div class="viewcode-block" id="dydx_2_err"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.dydx_2_err">[docs]</a><span class="k">def</span> <span class="nf">dydx_2_err</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">dy0</span><span class="p">,</span> <span class="n">dy1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return</span>
<span class="sd">    :param x0:</span>
<span class="sd">    :param x1:</span>
<span class="sd">    :param y0:</span>
<span class="sd">    :param y1:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">dy1</span> <span class="o">+</span> <span class="n">dy0</span><span class="p">)</span> <span class="o">/</span>
            <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span></div>


<div class="viewcode-block" id="center_dydx_3"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.center_dydx_3">[docs]</a><span class="k">def</span> <span class="nf">center_dydx_3</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return...</span>
<span class="sd">    :param x0:</span>
<span class="sd">    :param x1:</span>
<span class="sd">    :param x2:</span>
<span class="sd">    :param y0:</span>
<span class="sd">    :param y1:</span>
<span class="sd">    :param y2:</span>
<span class="sd">    :return: the three-point finite-difference derivative at x1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y0</span> <span class="o">*</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span>
                  <span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y1</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span>
                  <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y2</span> <span class="o">*</span> <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span>
                  <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))))</span></div>


<div class="viewcode-block" id="center_dydx_3_err"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.center_dydx_3_err">[docs]</a><span class="k">def</span> <span class="nf">center_dydx_3_err</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">dy0</span><span class="p">,</span> <span class="n">dy1</span><span class="p">,</span> <span class="n">dy2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return</span>
<span class="sd">    :param x0:</span>
<span class="sd">    :param x1:</span>
<span class="sd">    :param x2:</span>
<span class="sd">    :param dy0:</span>
<span class="sd">    :param dy1:</span>
<span class="sd">    :param dy2:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">dy0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">dy1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">dy2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))))</span></div>


<div class="viewcode-block" id="add_finite_difference_power_response"><a class="viewcode-back" href="../../../kid_readout.analysis.html#kid_readout.analysis.dataframe.add_finite_difference_power_response">[docs]</a><span class="k">def</span> <span class="nf">add_finite_difference_power_response</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">masker</span><span class="o">=</span><span class="k">lambda</span> <span class="n">group</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)):</span>
    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span><span class="p">):</span>
        <span class="n">dydx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dydx_err</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dydx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dydx_2</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">dydx_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dydx_2</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dy0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">dy1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dy2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                                                               <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                                               <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">y_err</span><span class="p">[</span><span class="mi">2</span><span class="p">:])):</span>
            <span class="n">dydx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_dydx_3</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
            <span class="n">dydx_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_dydx_3_err</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">dy0</span><span class="p">,</span> <span class="n">dy1</span><span class="p">,</span> <span class="n">dy2</span><span class="p">))</span>
        <span class="n">dydx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dydx_2</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">dydx_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dydx_2</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">dydx</span><span class="p">,</span> <span class="n">dydx_err</span>

    <span class="k">def</span> <span class="nf">finite_difference_power_response</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">masker</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">dX_dP</span><span class="p">,</span> <span class="n">dX_dP_err</span> <span class="o">=</span> <span class="n">calculate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="n">power</span><span class="p">]),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="s1">&#39;{}_X&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="s1">&#39;{}_X_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]))</span>
        <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fd_dX_dP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dX_dP</span>
        <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fd_dX_dP_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dX_dP_err</span>
        <span class="n">dI_dP</span><span class="p">,</span> <span class="n">dI_dP_err</span> <span class="o">=</span> <span class="n">calculate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="n">power</span><span class="p">]),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="s1">&#39;{}_I&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]),</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gm</span><span class="p">[</span><span class="s1">&#39;{}_I_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]))</span>
        <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fd_dI_dP&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dI_dP</span>
        <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;{}_fd_dI_dP_err&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dI_dP_err</span>
        <span class="k">return</span> <span class="n">group</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;atten&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">finite_difference_power_response</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">KID Readout  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>